# 电子影院系统（DTS）软件详细设计描述文档

## 1. 引言

### 1.1 编制目的

​	本报告详细完成对电子影院系统的详细设计，达到指导后续软件构造的目的，同时实现和测试人员及用户的沟通。

​	本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义 | 备注 |
| :-: | :-: | :-: |
| DTS | 电子影院系统 | …… |
| …… | …… | …… |

### 1.3 参考资料



## 2. 产品描述

​	参考电子影院系统用例文档和电子影院系统软件需求规格说明文档中对产品的概括描述。



## 3. 系统结构设计概述

​	参考电子影院管理系统概要设计文档中对体系结构设计的概述。



## 4. 结构视角

### 4.1 业务逻辑层的分解

​	业务逻辑层的开发包图参见软件体系结构文档图4。

<<<<<<< HEAD
#### 4.1.5 orderbl 模块

（1）模块描述

​	orderbl 模块承担的需求参见规格说明文档功能需求及相关非功能需求。
=======
#### 4.1.4 FilmArrangebl模块
>>>>>>> d77442290d9838392667eb4796fad0d39241b9e4

​	orderbl 模块的职责及接口参见软件体系结构描述文档表。

<<<<<<< HEAD
（2）整体结构
=======
FilmArrangebl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

FilmArrangebl模块的职责及接口参见软件系统结构设计文档。
>>>>>>> d77442290d9838392667eb4796fad0d39241b9e4

​	根据体系结构的设计，我们将系统分为展示层、业务逻辑层、数据区。每一层之间为了增加灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加businesslogicservice.orderblservice.OrderBLService 接口。业务逻辑层和数据层之间添加 dataservice.orderdataservice.OrderDataservice 接口。为了隔离业务逻辑职责和控制逻辑职责，我们增加了 OrdersController，这样 OrdersController 会将对订单的业务逻辑处理委托给 Orders 对象。OrdersPO 是作为订单的持久化对象被添加到设计模型中去的。而OneMovieInfo添加的是SalesPromotioninfo 和 VIPcardinfo 的容器类。 OneMovieInfo 保有电影订单的座位价格场次信息。SalesPromotioninfo，VIPcardinfo 和 Userinfo 都是根据依赖倒置原则，为了消除循环依赖而产生的接口。

<<<<<<< HEAD
​                                                                                                                    图 4-1-5-1 orderbl 模块各个类的设计
=======
![](47.111.9.220:8080/photos/details/Arrangeclass.png)

Arrangebl模块各个类的职责  

|     模块     |          职责          |
| :----------: | :--------------------: |
|   Arrange    |   负责排片信息的管理   |
|    FilmBl    |   接口，负责标记电影   |
| UserIdentity | 接口，负责获取身份信息 |
>>>>>>> d77442290d9838392667eb4796fad0d39241b9e4

![leitu2](http://47.111.9.220:8080/photos/details/leitu2.png)

<<<<<<< HEAD
​	orderbl 模块各个类的职责如下表所示。
=======
##### 5.3.2.4 FilmArrangebl模块的接口规范如下表所示。

​                                                                      表5-3-2-4 FilmArrangebl模块的接口规范

| **提供的服务（供接口）**                                     |                                 |                                                              |
| ------------------------------------------------------------ | ------------------------------- | ------------------------------------------------------------ |
|                                                              | 语法                            | public ResultMessage add(FilmArrangeVO vo)                   |
| FilmArrange.add                                              | 前置条件                        | 用户具有对应权限，提交的排片信息合法                         |
|                                                              | 后置条件                        | 系统持久化存储订单数据                                       |
|                                                              | 语法                            | public ArrayList<FilmArranges> showArranges(Date date，String movieHall，Enum visualAngle) |
| FilmArrange.showFilmArranges                                 | 前置条件                        | 用户具有对应权限，选择安排的日期，影厅和视角                 |
|                                                              | 后置条件                        | 系统返回对应的影片安排                                       |
|                                                              | 语法                            | public ResultMessage setVisibleTime(Date time)               |
| FilmArrange.setVisibleTime                                   | 前置条件                        | 用户具有对应权限，输入日期                                   |
|                                                              | 后置条件                        | 系统返回设置结果                                             |
|                                                              | 语法                            | public ResultMessage setVisibleTime(Date time)               |
| FilmArrange.changeVisibleTime                                | 前置条件                        | 用户具有对应权限，输入日期                                   |
|                                                              | 后置条件                        | 系统返回修改结果                                             |
|                                                              | 语法                            | public ResultMessage deleteFilmArrange(Date time)            |
| FilmArrange.deleteFilmArrange                                | 前置条件                        | 用户具有相应权限，选择对应时间段的排片进行删除               |
|                                                              | 后置条件                        | 系统返回修改结果                                             |
|                                                              | 语法                            | public ResultMessage changeFilmArrange(FilmArrangeVo arrange) |
| FilmArrange.changeFilmArrange                                | 前置条件                        | 用户具有相应权限，选择对应时间段的排片进行删除               |
| 需要的服务（需接口）                                         |                                 |                                                              |
| ------------------------------------------------------------ | ------------------------------- |                                                              |
| FilmArrangeDataService.insert(FilmArrangePO po)              | 插入FilmArrangePO单一持久化对象 |                                                              |
| FilmArrangeDataService.delete(long FilmArrangeID)            | 删除FilmArrangePO单一持久化对象 |                                                              |
| FilmArrangeDataService.findByMovie(String movie )            | 查找FilmArrangePO单一持久化对象 |                                                              |
| FilmArrangeDataService.find(Date date,String hall ,String movie) | 查找FilmArrangePO单一持久化对象 |                                                              |
| FilmArrangeDataService.update(FilmArrangePO po)              | 更新FilmArrangePO单一持久化对象 |                                                              |
>>>>>>> d77442290d9838392667eb4796fad0d39241b9e4

| 模块             | 职责                                                         |
| ---------------- | ------------------------------------------------------------ |
| OrdersController | 负责实现订单界面所需要的服务                                 |
| Order            | 订单的领域模型对象，拥有一个订单所持有的用户id、订单id、价格、座位信息、时间信息、电影信息、状态等信息，可以帮助完成订单界面所需要的服务 |

<<<<<<< HEAD
（3）模块内部实现的接口规范
=======
![](47.111.9.220:8080/photos/details/Arrange1.png)

![](47.111.9.220:8080/photos/details/Arrange2.png)

![](47.111.9.220:8080/photos/details/Arrange.png)
>>>>>>> d77442290d9838392667eb4796fad0d39241b9e4

​	OrdersController 和 Order 的接口规范如表所示。

<<<<<<< HEAD
​                                                                表 OrdersController 的接口规范

| **提供的服务（供接口）**      |          |                                                              |
| ----------------------------- | -------- | ------------------------------------------------------------ |
|                               | 语法     | public ResultMessage add(OrderVO vo)                         |
| OrdersController.add          | 前置条件 | 已创建一个 Order 领域对象，并且提交的电影票购买订单信息合法  |
|                               | 后置条件 | 调用 Order 领域对象的 add 方法                               |
|                               | 语法     | public ArrayList<Seat> showSeats(String time,int hallID)     |
| OrdersController.showSeats    | 前置条件 | 已创建一个 Order 领域对象，并且用户选择电影的场次            |
|                               | 后置条件 | 调用 Order 领域对象的 showSeats 方法                         |
|                               | 语法     | public ResultMessage cancel(long orderID)                    |
| OrdersController.cancel       | 前置条件 | 已创建一个 Order 领域对象，并且用户点击取消订单              |
|                               | 后置条件 | 调用 Order 领域对象的 cancel 方法                            |
|                               | 语法     | public double calculate(OrderVO vo)                          |
| OrdersController.calculate    | 前置条件 | 已创建一个 Order 领域对象，并且用户进入确认订单界面          |
|                               | 后置条件 | 调用 Order 领域对象的 calculate 方法                         |
|                               | 语法     | public double VIPpayment(long userID,doble payment)          |
| OrdersController.VIPpayment   | 前置条件 | 已创建一个 Order 领域对象，并且已计算出消费总额              |
|                               | 后置条件 | 调用 Order 领域对象的 VIPpayment 方法                        |
|                               | 语法     | public ResultMessage paymentError(OrderVO vo)                |
| OrdersController.paymentError | 前置条件 | 已创建一个 Order 领域对象，并且用户选择稍后支付或支付中异常退出 |
|                               | 后置条件 | 调用 Order 领域对象的 paymentError 方法                      |
|                               | 语法     | public ResultMessage verification(string password)           |
| OrdersController.verification | 前置条件 | 已创建一个 Order 领域对象，并且用户输入支付密码              |
|                               | 后置条件 | 调用 Order 领域对象的 verification 方法                      |

| 需要的服务（需接口） |                  |
| -------------------- | ---------------- |
| Order.add            | 加入一个订单对象 |
| …                    | …                |



​                                                                       表4-1-5-1 Order 的接口规范

| **提供的服务（供接口）** |          |                                                          |
| ------------------------ | -------- | -------------------------------------------------------- |
|                          | 语法     | public ResultMessage add(OrderVO vo)                     |
| Order.add                | 前置条件 | 提交的电影票购买订单信息合法                             |
|                          | 后置条件 | 系统持久化存储订单数据                                   |
|                          | 语法     | public ArrayList<Seat> showSeats(String time,int hallID) |
| Order.showSeats          | 前置条件 | 用户选择电影的场次                                       |
|                          | 后置条件 | 系统返回该电影该场次的座位列表                           |
|                          | 语法     | public ResultMessage cancel(long orderID)                |
| Order.cancel             | 前置条件 | 用户点击取消订单                                         |
|                          | 后置条件 | 解锁位置信息，退回至选座阶段                             |
|                          | 语法     | public double calculate(OrderVO vo)                      |
| Order.calculate          | 前置条件 | 用户进入确认订单界面                                     |
|                          | 后置条件 | 系统计算出最优优惠策略，返回需要的金额                   |
|                          | 语法     | public double VIPpayment(long userID,doble payment)      |
| Order.VIPpayment         | 前置条件 | 已计算出消费总额                                         |
|                          | 后置条件 | 根据会员卡余额，计算支付后会员卡的余额                   |
|                          | 语法     | public ResultMessage paymentError(OrderVO vo)            |
| Order.paymentError       | 前置条件 | 用户选择稍后支付或支付中异常退出                         |
|                          | 后置条件 | 等待15分钟后取消订单                                     |
|                          | 语法     | public ResultMessage verification(string password)       |
| Order.verification       | 前置条件 | 用户输入支付密码                                         |
|                          | 后置条件 | 密码正确提示进行扣款或密码错误提示返回支付界面           |

| 需要的服务（需接口）                                    |                                     |
| ------------------------------------------------------- | ----------------------------------- |
| OrderDataService.insert(OrderPO po)                     | 插入OrderPO单一持久化对象           |
| OrderDataService.delete(long orderID)                   | 删除OrderPO单一持久化对象           |
| OrderDataService.updatePaymentState(state paymentState) | 更新OrderPO的支付状态               |
| OrderDataService.findByUserID(long userID)              | 根据用户ID查找OrderPO单一持久化对象 |
| OrderDataService.findByOrderID(long orderID)            | 根据订单ID查找OrderPO单一持久化对象 |
| OrderDataService.update(OrderPO po)                     | 更新OrderPO单一持久化对象           |



（4）业务逻辑层的动态模型

​	图4-1-5-2 表明了电子影院系统中，新增一个订单后，业务逻辑处理的相关对象之间的协作。

​                                                                                                                                             图4-1-5-2 

![](http://47.111.9.220:8080/photos/details/newOrder.png)

​	图4-1-5-3 表明了电子影院系统中，用户点击选座按钮，业务逻辑处理的相关对象之间的协作。

​																		图4-1-5-3

![](http://47.111.9.220:8080/photos/details/showSeats.png)

​	图4-1-5-4 表明了电子影院系统中，用户点击确认选座，业务逻辑选择最优策略的协作。

​																       图4-1-5-4

![](http://47.111.9.220:8080/photos/details/calculate.png)

​	图4-1-5-5 表明了电子影院系统中，删除订单时业务逻辑处理的相关对象之间的协作。

​																              图4-1-5-5

![](http://47.111.9.220:8080/photos/details/delete.png)

​	图4-1-5-6 表明了电子影院系统中，查看订单时业务逻辑处理的相关对象之间的协作。

​																	       图4-1-5-6

![](http://47.111.9.220:8080/photos/details/find.png)

​	如图4-1-5-7所示的状态图描述了 Order 对象的生存起见的状态序列、引起转移的事件，以及因状态转移而伴随的动作。

​																		图4-1-5-7

![](http://47.111.9.220:8080/photos/details/zhuangtaitu1.png)

（5）业务逻辑层的设计原理

​	利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象。

​	其他略。
=======
委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的对象  
>>>>>>> d77442290d9838392667eb4796fad0d39241b9e4

## 5. 依赖视角
